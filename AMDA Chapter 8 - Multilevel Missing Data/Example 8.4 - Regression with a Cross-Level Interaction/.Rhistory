# example 8.4: analyze model-based multiple imputations for a multilevel regression with a cross-level interaction
# requires fdir, rockchalk, lme4, and mitml packages
# set working directory
fdir::set()
# read imputed data from working directory
imps <- read.table("imps.dat")
names(imps) <- c("Imputation", "employee","team","turnover","male","empower","lmx","jobsat","climate","cohesion",
"random.intercepts", "random.slopes", "lmx.latentmean")
# center at grand means and imputed latent group means
imps$male.cgm <- imps$male - mean(imps$male)
imps$lmx.cwc <- imps$lmx - imps$lmx.latentmean
imps$cohesion.cgm <- imps$cohesion - mean(imps$cohesion)
imps$climate.cgm <- imps$climate - mean(imps$climate)
# compute product of imputed variables
imps$lmx.by.climate <- imps$lmx.cwc * imps$climate.cgm
plot(density(imps$random.intercepts))
rockchalk::skewness(imps$random.intercepts)
rockchalk::kurtosis(imps$random.intercepts)
plot(density(imps$random.slopes))
rockchalk::skewness(imps$random.slopes)
rockchalk::kurtosis(imps$random.slopes)
implist <- as.mitml.list(split(imps, imps$Imputation))
model <- "empower ~ lmx.cwc  + male.cgm + cohesion.cgm + climate.cgm + lmx.by.climate + (1 + lmx.cwc | team)"
analysis <- with(implist, lmer(model, REML = T))
implist <- mitml::as.mitml.list(split(imps, imps$Imputation))
model <- "empower ~ lmx.cwc  + male.cgm + cohesion.cgm + climate.cgm + lmx.by.climate + (1 + lmx.cwc | team)"
analysis <- with(implist, lmer(model, REML = T))
analysis <- with(implist, lme4::lmer(model, REML = T))
df <- 105 - 5 - 1
estimates <- mitml::testEstimates(analysis, extra.pars = T, df.com = df)
estimates
confint(estimates, level = .95)
climate.sd <- sd(imps$climate)
lmx.at.high.climate <- c("lmx.cwc + lmx.by.climate*climate.sd")
mitml::testConstraints(analysis, constraints = lmx.at.high.climate, df.com = df)
lmx.at.low.climate <- c("lmx.cwc + lmx.by.climate*-climate.sd")
mitml::testConstraints(analysis, constraints = lmx.at.low.climate, df.com = df)
